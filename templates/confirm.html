<!DOCTYPE html>
<html>
<head>
    <title>候補日確定</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<h2>候補日一覧</h2>

<table border="1">
    <tr>
        <th>日付</th>
        <th>体育館</th>
        <th>時間</th>
        <th>確定</th>
        <th>編集</th>
        <th>削除</th>
    </tr>

    {% for c in candidates %}
    <tr class="{% if c.id in confirmed_ids %}confirmed{% endif %}">

        <td class="date-large">{{ c.md }}</td>
        <td>{{ c.gym }}</td>
        <td>{{ c.start }} 〜 {{ c.end }}</td>

       <td>
            {% if c.id in confirmed_ids %}
                <!-- 確定解除ボタン -->
                <form method="POST" action="{{ url_for('unconfirm', candidate_id=c.id) }}">
                    <button style="background:#e67e22; color:white;">確定解除</button>
                </form>
            {% else %}
                <!-- 確定ボタン -->
                <form method="POST" action="{{ url_for('confirm') }}">
                    <input type="hidden" name="candidate_id" value="{{ c.id }}">
                    <button>確定</button>
                </form>
            {% endif %}
        </td>


        <!-- 編集 -->
        <td>
            <form method="GET" action="{{ url_for('edit_candidate', id=c.id) }}">
                <button>編集</button>
            </form>
        </td>

        <!-- 削除 -->
        <td>
            <form method="POST" action="{{ url_for('delete_candidate', id=c.id) }}">
                <button onclick="return confirm('この候補日を削除しますか？')">削除</button>
            </form>
        </td>
    </tr>
    {% endfor %}
</table>

<br><hr>

<h2>確定済み日程</h2>

{% for ev in confirmed_info %}
<div class="event-box" style="border:1px solid #ccc; padding:10px; margin-bottom:15px;">

    <h3>{{ ev.md }} {{ ev.gym }} {{ ev.start }}〜{{ ev.end }}</h3>

    <p>
        参加: {{ ev.count_participants }}名  
        {% if ev.participants %}
            （{{ ev.participants | join(", ") }}）
        {% endif %}
    </p>

    <p>
        不参加: {{ ev.count_absents }}名  
        {% if ev.absents %}
            （{{ ev.absents | join(", ") }}）
        {% endif %}
    </p>

    <!-- 編集ページへ -->
    <a href="{{ url_for('manage_event_attendance', event_id=ev.id) }}">
        ▶ 参加者 編集ページへ
    </a>

    <br><br>

    <!-- 確定解除 -->
    <form method="POST" action="{{ url_for('unconfirm', candidate_id=ev.candidate_id) }}">
        <button type="submit" style="background:#e67e22; color:white;">確定解除</button>
    </form>

</div>
{% endfor %}


<br>
<a href="{{ url_for('admin_menu') }}">管理者メニューへ戻る</a>

</body>
</html>
